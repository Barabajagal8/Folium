<!doctype html>
<html>
<head>
    <link href="css/newstyle.css" rel="stylesheet">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Ubuntu);
    </style>
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
     <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
     <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
     <script>
       // Initialize Firebase
       var config = {
       apiKey: "AIzaSyBfhX8hm-A3IAn2us9ybZiP_GWg-H-5sC8",
       authDomain: "folium-93435.firebaseapp.com",
       databaseURL: "https://folium-93435.firebaseio.com",
       projectId: "folium-93435",
       storageBucket: "folium-93435.appspot.com",
       messagingSenderId: "700685483452"
       };
       firebase.initializeApp(config);
     </script>
     <script>
        $(document).ready(function() {
            $('.picture a').click(function(evt){
                evt.preventDefault();

                var imgPath=$(this).attr('href');
                var oldImage=$('#contents-3-center-pic1 img');

                var newImage=$('<img src="' + imgPath +'">');
                newImage.hide();


                $('#contents-3-center-pic1').prepend(newImage);

                oldImage.fadeOut(1000, function(){
                $(this).remove();
                });
                newImage.fadeIn(1000);

            }); //end click
            $('.picture a:first').click();
        });//end ready
    </script>
</head>
<body>
    <div id="naviBar">
        <a href="index.html"><img id="naviBar-img" src="pictures/folium.jpg"></a>
        <ul id="naviBar-ul1">
            <a href="#"><li class="navilist">My Flower</li></a>
            <a href="002.Neighbor.html"><li class="navilist">Neighbor's</li></a>
            <a href="003.Ranking.html"><li class="navilist">Ranking</li></a>
            <a href="004.About.html"><li class="navilist">About us</li></a>
        </ul>
        <ul id="naviBar-ul2">
            <a href="./login.html"><li id="login" class="navilist">Login</li></a>
            <a id="logout" onclick="logout()"><li class="navilist">Logout</li></a>
        </ul>
    </div>
    <div id="contents">
        <div id="contents-1">
            <h2>Manage your Plant!</h2>
        </div>
        <div id="contents-2">
            <h3>Keep track of your plants by registering them to "My Plants"</h3>
            <ul>
                <li class="navilist">Plants 1</li>
                <li class="navilist">Plants 2</li>
                <li class="navilist">Plants 3</li>
            </ul>
        </div>
        <div id="contents-3">
            <div id="contents-3-left">
                <div id="contents-3-left-pic1" class="picture">
                    <a class= "links" href="pictures/001_1.png"> <img class= "loadImage" src="pictures/001_1.png"></a>
                </div>
                <div id="contents-3-left-pic2" class="picture">
                    <a class= "links" href="pictures/001_2.png"><img class= "loadImage" src="pictures/001_2.png"></a>
                </div>
                <div id="contents-3-left-pic3" class="picture">
                    <a class= "links" href="pictures/001_3.png"><img class= "loadImage" src="pictures/001_3.png"></a>
                </div>
            </div>
            <!-- Uploads photo to firebase -->
            <div id="contents-3-center">
                <div id="contents-3-center-pic1">
                  <input type="file"
                       id="photo" name="photo"
                       accept="image/png, image/jpeg, image/jpg">
                	<button onclick="upload()">Upload</button>
                  <!-- The Modal -->
              <div id="myModal" class="modal">

                <!-- Modal content -->
                <div class="modal-content">
                  <span class="close">&times;</span>
                  <p>Successful Upload</p>
                </div>

              </div>

                </div>
            </div>
            <div id="contents-3-right">
                    <h4>Plant Type</h4>
                    <div class="plantTypeBox">
                        <p>Bolivian Fern</p>
                    </div>

                    <h4>Age</h4>
                    <div class="ageBox">
                        <p>1 years old</p>
                    </div>
                    <div id="recentCommentsWrapper">
                        <h4>Recent Comments</h4>
                        <div class="commentsContainer">
                            <div class="comments">
                                <div class="commentBox">
                                    <div class="imgBox">
                                        <img class="testface" src="pictures/testface.jpg">
                                    </div>
                                    <div class="paragraphBox">
                                        <p>
                                        <span class="commentMover">
                                        I'm in love with this plant where did you get it?</span><span class="postdate"> 2 hours ago</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="commentBox">
                                    <div class="imgBox">
                                        <img class="testface" src="pictures/dummyhead2.jpg">
                                    </div>
                                    <div class="paragraphBox">
                                        <p>
                                        <span class="commentMover">
                                        How much many time a week do you water it?</span><span class="postdate"> 22 hours ago</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="commentBox">
                                    <div class="imgBox">
                                        <img class="testface" src="pictures/dummyhead3.jpg">
                                    </div>
                                    <div class="paragraphBox">
                                        <p>
                                        <span class="commentMover">Amazing plant, love your posts.
                                        </span><span class="postdate"> 2 days ago</span>
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div>
                        <h4>Tag</h4>
                        <div class="tagBox">
                            <p>#<small>rose</small>#<small>redrose</small>#<small>beautifulplants</small>#<small>nature</small></p>
                        </div>
                    </div>
            </div>
        </div>
    </div>
    <div id="footer">
        <div>
            <br>
            Folium<br>
            Telephone : 250-328-2656<br>
            Address : BCIT Student resident, Nisga'a D 551
         </div>
    </div>
   
</body>
<script>
// Get the modal
var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("upload");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
//btn.onclick = function() {
//  modal.style.display = "block";
//}

// When the user clicks on <span> (x), close the modal
//span.onclick = function() {
//  modal.style.display = "none";
//}

// When the user clicks anywhere outside of the modal, close it
//window.onclick = function(event) {
//  if (event.target == modal) {
//    modal.style.display = "none";
//  }
//}
firebase.auth().onAuthStateChanged(function(user) {
	var user = firebase.auth().currentUser;
	var name;

	if (user != null) {
 		 name = user.displayName;
	}
    if (user) {
		document.getElementById("login").innerHTML = name;
    }else {
   	 console.log("Not signed in");
 	 }
});
function snapshotToArray(snapshot) {
    var returnArr = [];

    snapshot.forEach(function(childSnapshot) {
        var item = childSnapshot.val();
        item.key = childSnapshot.key;

        returnArr.push(item);
    });
    return returnArr;
};

window.addEventListener("load", function() {
  setTimeout(function() {
	var storage = firebase.storage();
	var storageRef = storage.ref();
	var user = firebase.auth().currentUser;
	var name;
	var urlArray;

	if (user != null) {
 		 name = user.displayName;
	}

    var urlList = firebase.database().ref('users/' + name + '/photoURL');

    urlList.on('value', function(snapshot) {
        urlArray =	snapshotToArray(snapshot);
        console.log(urlArray);
        });
				setTimeout(function() {
	        var images = document.getElementsByClassName('loadImage')
          var links = document.getElementsByClassName('links')

	        console.log("length: " + images.length);
					console.log(images);
	        console.log("urls: " + urlArray.length);
	        console.log(images);
	        for (var i = 0; i < images.length; i++) {
            if(urlArray.length < 3) {
            return;
            }
	        //var img = document.getElementById('myimg');
	        images[i].src = urlArray[i];
          links[i].href = urlArray[i];
	        }
				}, 1000);
      }, 1000);
});
function logout() {
	firebase.auth().signOut().then(function() {
		console.log('Signed Out');
		document.getElementById("login").innerHTML = "Login";
	}, function(error) {
 		console.error('Sign Out Error', error);
	});
}
function upload() {
	var user = firebase.auth().currentUser.displayName;
	const ref = firebase.storage().ref();
	const file = document.querySelector('#photo').files[0];
	const name = (+new Date()) + '-' + file.name;
	const metadata = {
	  contentType: file.type
	};
	const task = ref.child(user + "/images/" + name).put(file, metadata);
	task
	  .then(snapshot => snapshot.ref.getDownloadURL())
	  .then((url) => {
		var user = firebase.auth().currentUser;
		firebase.database().ref("users/" + user.displayName + "/photoURL/").push(url);
		document.querySelector('#photo').src = url;
	  })
	  .catch(console.error);
    document.getElementById("photo").value = "";
}
</script>
</html>
